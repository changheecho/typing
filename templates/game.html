{% extends "base.html" %}

{% block title %}Stage {{ stage }} - 타이핑 마스터{% endblock %}

{% block content %}
<div class="game-container">
    <!-- 게임 헤더 -->
    <div class="game-header">
        <div class="container-fluid">
            <div class="row align-items-center py-2">
                <div class="col-md-3">
                    <div class="game-info">
                        <span class="badge bg-primary fs-6 me-2">Stage {{ stage }}</span>
                        <a href="{{ url_for('dashboard') }}" class="btn btn-outline-light btn-sm">
                            <i class="fas fa-arrow-left me-1"></i>대시보드
                        </a>
                    </div>
                </div>
                <div class="col-md-6 text-center">
                    <div class="game-stats">
                        <span class="stat-item me-3">
                            <i class="fas fa-bullseye text-warning"></i>
                            점수: <span id="score">0</span>
                        </span>
                        <span class="stat-item me-3">
                            <i class="fas fa-percentage text-success"></i>
                            정확도: <span id="accuracy">100</span>%
                        </span>
                        <span class="stat-item">
                            <i class="fas fa-clock text-info"></i>
                            남은 단어: <span id="remaining">0</span>
                        </span>
                    </div>
                </div>
                <div class="col-md-3 text-end">
                    <button id="pauseBtn" class="btn btn-warning">
                        <i class="fas fa-pause"></i> 일시정지
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- 게임 영역 -->
    <div class="game-area" id="gameArea">
        <!-- 하늘 영역 -->
        <div class="sky-area">
            <div class="clouds">
                <div class="cloud cloud-1"></div>
                <div class="cloud cloud-2"></div>
                <div class="cloud cloud-3"></div>
            </div>
        </div>

        <!-- 떨어지는 단어들이 표시될 영역 -->
        <div class="words-container" id="wordsContainer"></div>

        <!-- 바다 영역 -->
        <div class="ocean-area">
            <div class="waves">
                <div class="wave wave-1"></div>
                <div class="wave wave-2"></div>
                <div class="wave wave-3"></div>
            </div>
        </div>
    </div>

    <!-- 타이핑 입력 영역 -->
    <div class="typing-area">
        <div class="container">
            <div class="row justify-content-center">
                <div class="col-md-8">
                    <div class="input-container">
                        <input type="text" id="typingInput" class="form-control typing-input" 
                               placeholder="여기에 단어를 입력하세요..." autocomplete="off" spellcheck="false">
                        <div class="input-feedback" id="inputFeedback"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- 게임 완료 모달 -->
    <div class="modal fade" id="gameCompleteModal" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header bg-success text-white">
                    <h5 class="modal-title">
                        <i class="fas fa-trophy me-2"></i>단계 완료!
                    </h5>
                </div>
                <div class="modal-body text-center">
                    <div class="completion-stats">
                        <div class="row">
                            <div class="col-4">
                                <div class="stat-box">
                                    <h3 id="finalScore" class="text-primary">0</h3>
                                    <p>최종 점수</p>
                                </div>
                            </div>
                            <div class="col-4">
                                <div class="stat-box">
                                    <h3 id="finalAccuracy" class="text-success">0%</h3>
                                    <p>정확도</p>
                                </div>
                            </div>
                            <div class="col-4">
                                <div class="stat-box">
                                    <h3 id="wordsCompleted" class="text-info">0</h3>
                                    <p>완료 단어</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <a href="{{ url_for('dashboard') }}" class="btn btn-secondary">대시보드로</a>
                    <button type="button" class="btn btn-primary" id="nextStageBtn">다음 단계</button>
                </div>
            </div>
        </div>
    </div>

    <!-- 게임 오버 모달 -->
    <div class="modal fade" id="gameOverModal" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header bg-danger text-white">
                    <h5 class="modal-title">
                        <i class="fas fa-times-circle me-2"></i>게임 오버
                    </h5>
                </div>
                <div class="modal-body text-center">
                    <p>단어가 바다에 떨어졌습니다. 다시 도전해보세요!</p>
                    <div class="mt-3">
                        <h5>최종 결과</h5>
                        <p>점수: <span id="gameOverScore">0</span></p>
                        <p>정확도: <span id="gameOverAccuracy">0</span>%</p>
                    </div>
                </div>
                <div class="modal-footer">
                    <a href="{{ url_for('dashboard') }}" class="btn btn-secondary">대시보드로</a>
                    <button type="button" class="btn btn-primary" onclick="location.reload()">다시 시도</button>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script src="{{ url_for('static', filename='js/game.js') }}"></script>
<script>
    // 게임 설정 전달
    const gameConfig = {
        stage: {{ stage }},
        speed: {{ config.speed }},
        wordCount: {{ config.word_count }},
        wordType: '{{ config.word_type }}'
    };
    
    // 게임 초기화
    document.addEventListener('DOMContentLoaded', function() {
        initGame(gameConfig);
    });
</script>
{% endblock %}
